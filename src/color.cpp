// Ian Harvey
// Color C++ file

#include "color.h"
#include <iostream>

std::string colorToANSI(color* c) {
  std::string hexString = c->hexString();
  if(xtermANSI.find(hexString) == xtermANSI.end()) {
    uint minDist = 0xFFFFFFFF;
    std::string hexOverride;
    for(auto kvPair : xtermANSI) {
      color diff = std::get<1>(kvPair.second) - *c;
      int total = diff.r + diff.g + diff.b;
      if(kvPair.first.find("SYS") == std::string::npos && total < minDist) {
	hexOverride = kvPair.first;
	minDist = total;
      }
    }
    xtermANSI[hexString] = xtermANSI[hexOverride];
  }
  return "\033[38;5;" +  std::to_string(((int) std::get<0>(xtermANSI[hexString])) & 0xFF) + "m██";
}

std::unordered_map<std::string, std::tuple<char, color>> xtermANSI =
  {
    { "000000SYS", {0, { 0, 0, 0}} },
    { "800000SYS", {1, { 128, 0, 0}} },
    { "008000SYS", {2, { 0, 128, 0}} },
    { "808000SYS", {3, { 128, 128, 0}} },
    { "000080SYS", {4, { 0, 0, 128}} },
    { "800080SYS", {5, { 128, 0, 128}} },
    { "008080SYS", {6, { 0, 128, 128}} },
    { "c0c0c0SYS", {7, { 192, 192, 192}} },
    { "808080SYS", {8, { 128, 128, 128}} },
    { "ff0000SYS", {9, { 255, 0, 0}} },
    { "00ff00SYS", {10, { 0, 255, 0}} },
    { "ffff00SYS", {11, { 255, 255, 0}} },
    { "0000ffSYS", {12, { 0, 0, 255}} },
    { "ff00ffSYS", {13, { 255, 0, 255}} },
    { "00ffffSYS", {14, { 0, 255, 255}} },
    { "ffffffSYS", {15, { 255, 255, 255}} },
    { "000000", {16, { 0, 0, 0}} },
    { "00005f", {17, { 0, 0, 95}} },
    { "000087", {18, { 0, 0, 135}} },
    { "0000af", {19, { 0, 0, 175}} },
    { "0000d7", {20, { 0, 0, 215}} },
    { "0000ff", {21, { 0, 0, 255}} },
    { "005f00", {22, { 0, 95, 0}} },
    { "005f5f", {23, { 0, 95, 95}} },
    { "005f87", {24, { 0, 95, 135}} },
    { "005faf", {25, { 0, 95, 175}} },
    { "005fd7", {26, { 0, 95, 215}} },
    { "005fff", {27, { 0, 95, 255}} },
    { "008700", {28, { 0, 135, 0}} },
    { "00875f", {29, { 0, 135, 95}} },
    { "008787", {30, { 0, 135, 135}} },
    { "0087af", {31, { 0, 135, 175}} },
    { "0087d7", {32, { 0, 135, 215}} },
    { "0087ff", {33, { 0, 135, 255}} },
    { "00af00", {34, { 0, 175, 0}} },
    { "00af5f", {35, { 0, 175, 95}} },
    { "00af87", {36, { 0, 175, 135}} },
    { "00afaf", {37, { 0, 175, 175}} },
    { "00afd7", {38, { 0, 175, 215}} },
    { "00afff", {39, { 0, 175, 255}} },
    { "00d700", {40, { 0, 215, 0}} },
    { "00d75f", {41, { 0, 215, 95}} },
    { "00d787", {42, { 0, 215, 135}} },
    { "00d7af", {43, { 0, 215, 175}} },
    { "00d7d7", {44, { 0, 215, 215}} },
    { "00d7ff", {45, { 0, 215, 255}} },
    { "00ff00", {46, { 0, 255, 0}} },
    { "00ff5f", {47, { 0, 255, 95}} },
    { "00ff87", {48, { 0, 255, 135}} },
    { "00ffaf", {49, { 0, 255, 175}} },
    { "00ffd7", {50, { 0, 255, 215}} },
    { "00ffff", {51, { 0, 255, 255}} },
    { "5f0000", {52, { 95, 0, 0}} },
    { "5f005f", {53, { 95, 0, 95}} },
    { "5f0087", {54, { 95, 0, 135}} },
    { "5f00af", {55, { 95, 0, 175}} },
    { "5f00d7", {56, { 95, 0, 215}} },
    { "5f00ff", {57, { 95, 0, 255}} },
    { "5f5f00", {58, { 95, 95, 0}} },
    { "5f5f5f", {59, { 95, 95, 95}} },
    { "5f5f87", {60, { 95, 95, 135}} },
    { "5f5faf", {61, { 95, 95, 175}} },
    { "5f5fd7", {62, { 95, 95, 215}} },
    { "5f5fff", {63, { 95, 95, 255}} },
    { "5f8700", {64, { 95, 135, 0}} },
    { "5f875f", {65, { 95, 135, 95}} },
    { "5f8787", {66, { 95, 135, 135}} },
    { "5f87af", {67, { 95, 135, 175}} },
    { "5f87d7", {68, { 95, 135, 215}} },
    { "5f87ff", {69, { 95, 135, 255}} },
    { "5faf00", {70, { 95, 175, 0}} },
    { "5faf5f", {71, { 95, 175, 95}} },
    { "5faf87", {72, { 95, 175, 135}} },
    { "5fafaf", {73, { 95, 175, 175}} },
    { "5fafd7", {74, { 95, 175, 215}} },
    { "5fafff", {75, { 95, 175, 255}} },
    { "5fd700", {76, { 95, 215, 0}} },
    { "5fd75f", {77, { 95, 215, 95}} },
    { "5fd787", {78, { 95, 215, 135}} },
    { "5fd7af", {79, { 95, 215, 175}} },
    { "5fd7d7", {80, { 95, 215, 215}} },
    { "5fd7ff", {81, { 95, 215, 255}} },
    { "5fff00", {82, { 95, 255, 0}} },
    { "5fff5f", {83, { 95, 255, 95}} },
    { "5fff87", {84, { 95, 255, 135}} },
    { "5fffaf", {85, { 95, 255, 175}} },
    { "5fffd7", {86, { 95, 255, 215}} },
    { "5fffff", {87, { 95, 255, 255}} },
    { "870000", {88, { 135, 0, 0}} },
    { "87005f", {89, { 135, 0, 95}} },
    { "870087", {90, { 135, 0, 135}} },
    { "8700af", {91, { 135, 0, 175}} },
    { "8700d7", {92, { 135, 0, 215}} },
    { "8700ff", {93, { 135, 0, 255}} },
    { "875f00", {94, { 135, 95, 0}} },
    { "875f5f", {95, { 135, 95, 95}} },
    { "875f87", {96, { 135, 95, 135}} },
    { "875faf", {97, { 135, 95, 175}} },
    { "875fd7", {98, { 135, 95, 215}} },
    { "875fff", {99, { 135, 95, 255}} },
    { "878700", {100, { 135, 135, 0}} },
    { "87875f", {101, { 135, 135, 95}} },
    { "878787", {102, { 135, 135, 135}} },
    { "8787af", {103, { 135, 135, 175}} },
    { "8787d7", {104, { 135, 135, 215}} },
    { "8787ff", {105, { 135, 135, 255}} },
    { "87af00", {106, { 135, 175, 0}} },
    { "87af5f", {107, { 135, 175, 95}} },
    { "87af87", {108, { 135, 175, 135}} },
    { "87afaf", {109, { 135, 175, 175}} },
    { "87afd7", {110, { 135, 175, 215}} },
    { "87afff", {111, { 135, 175, 255}} },
    { "87d700", {112, { 135, 215, 0}} },
    { "87d75f", {113, { 135, 215, 95}} },
    { "87d787", {114, { 135, 215, 135}} },
    { "87d7af", {115, { 135, 215, 175}} },
    { "87d7d7", {116, { 135, 215, 215}} },
    { "87d7ff", {117, { 135, 215, 255}} },
    { "87ff00", {118, { 135, 255, 0}} },
    { "87ff5f", {119, { 135, 255, 95}} },
    { "87ff87", {120, { 135, 255, 135}} },
    { "87ffaf", {121, { 135, 255, 175}} },
    { "87ffd7", {122, { 135, 255, 215}} },
    { "87ffff", {123, { 135, 255, 255}} },
    { "af0000", {124, { 175, 0, 0}} },
    { "af005f", {125, { 175, 0, 95}} },
    { "af0087", {126, { 175, 0, 135}} },
    { "af00af", {127, { 175, 0, 175}} },
    { "af00d7", {128, { 175, 0, 215}} },
    { "af00ff", {129, { 175, 0, 255}} },
    { "af5f00", {130, { 175, 95, 0}} },
    { "af5f5f", {131, { 175, 95, 95}} },
    { "af5f87", {132, { 175, 95, 135}} },
    { "af5faf", {133, { 175, 95, 175}} },
    { "af5fd7", {134, { 175, 95, 215}} },
    { "af5fff", {135, { 175, 95, 255}} },
    { "af8700", {136, { 175, 135, 0}} },
    { "af875f", {137, { 175, 135, 95}} },
    { "af8787", {138, { 175, 135, 135}} },
    { "af87af", {139, { 175, 135, 175}} },
    { "af87d7", {140, { 175, 135, 215}} },
    { "af87ff", {141, { 175, 135, 255}} },
    { "afaf00", {142, { 175, 175, 0}} },
    { "afaf5f", {143, { 175, 175, 95}} },
    { "afaf87", {144, { 175, 175, 135}} },
    { "afafaf", {145, { 175, 175, 175}} },
    { "afafd7", {146, { 175, 175, 215}} },
    { "afafff", {147, { 175, 175, 255}} },
    { "afd700", {148, { 175, 215, 0}} },
    { "afd75f", {149, { 175, 215, 95}} },
    { "afd787", {150, { 175, 215, 135}} },
    { "afd7af", {151, { 175, 215, 175}} },
    { "afd7d7", {152, { 175, 215, 215}} },
    { "afd7ff", {153, { 175, 215, 255}} },
    { "afff00", {154, { 175, 255, 0}} },
    { "afff5f", {155, { 175, 255, 95}} },
    { "afff87", {156, { 175, 255, 135}} },
    { "afffaf", {157, { 175, 255, 175}} },
    { "afffd7", {158, { 175, 255, 215}} },
    { "afffff", {159, { 175, 255, 255}} },
    { "d70000", {160, { 215, 0, 0}} },
    { "d7005f", {161, { 215, 0, 95}} },
    { "d70087", {162, { 215, 0, 135}} },
    { "d700af", {163, { 215, 0, 175}} },
    { "d700d7", {164, { 215, 0, 215}} },
    { "d700ff", {165, { 215, 0, 255}} },
    { "d75f00", {166, { 215, 95, 0}} },
    { "d75f5f", {167, { 215, 95, 95}} },
    { "d75f87", {168, { 215, 95, 135}} },
    { "d75faf", {169, { 215, 95, 175}} },
    { "d75fd7", {170, { 215, 95, 215}} },
    { "d75fff", {171, { 215, 95, 255}} },
    { "d78700", {172, { 215, 135, 0}} },
    { "d7875f", {173, { 215, 135, 95}} },
    { "d78787", {174, { 215, 135, 135}} },
    { "d787af", {175, { 215, 135, 175}} },
    { "d787d7", {176, { 215, 135, 215}} },
    { "d787ff", {177, { 215, 135, 255}} },
    { "d7af00", {178, { 215, 175, 0}} },
    { "d7af5f", {179, { 215, 175, 95}} },
    { "d7af87", {180, { 215, 175, 135}} },
    { "d7afaf", {181, { 215, 175, 175}} },
    { "d7afd7", {182, { 215, 175, 215}} },
    { "d7afff", {183, { 215, 175, 255}} },
    { "d7d700", {184, { 215, 215, 0}} },
    { "d7d75f", {185, { 215, 215, 95}} },
    { "d7d787", {186, { 215, 215, 135}} },
    { "d7d7af", {187, { 215, 215, 175}} },
    { "d7d7d7", {188, { 215, 215, 215}} },
    { "d7d7ff", {189, { 215, 215, 255}} },
    { "d7ff00", {190, { 215, 255, 0}} },
    { "d7ff5f", {191, { 215, 255, 95}} },
    { "d7ff87", {192, { 215, 255, 135}} },
    { "d7ffaf", {193, { 215, 255, 175}} },
    { "d7ffd7", {194, { 215, 255, 215}} },
    { "d7ffff", {195, { 215, 255, 255}} },
    { "ff0000", {196, { 255, 0, 0}} },
    { "ff005f", {197, { 255, 0, 95}} },
    { "ff0087", {198, { 255, 0, 135}} },
    { "ff00af", {199, { 255, 0, 175}} },
    { "ff00d7", {200, { 255, 0, 215}} },
    { "ff00ff", {201, { 255, 0, 255}} },
    { "ff5f00", {202, { 255, 95, 0}} },
    { "ff5f5f", {203, { 255, 95, 95}} },
    { "ff5f87", {204, { 255, 95, 135}} },
    { "ff5faf", {205, { 255, 95, 175}} },
    { "ff5fd7", {206, { 255, 95, 215}} },
    { "ff5fff", {207, { 255, 95, 255}} },
    { "ff8700", {208, { 255, 135, 0}} },
    { "ff875f", {209, { 255, 135, 95}} },
    { "ff8787", {210, { 255, 135, 135}} },
    { "ff87af", {211, { 255, 135, 175}} },
    { "ff87d7", {212, { 255, 135, 215}} },
    { "ff87ff", {213, { 255, 135, 255}} },
    { "ffaf00", {214, { 255, 175, 0}} },
    { "ffaf5f", {215, { 255, 175, 95}} },
    { "ffaf87", {216, { 255, 175, 135}} },
    { "ffafaf", {217, { 255, 175, 175}} },
    { "ffafd7", {218, { 255, 175, 215}} },
    { "ffafff", {219, { 255, 175, 255}} },
    { "ffd700", {220, { 255, 215, 0}} },
    { "ffd75f", {221, { 255, 215, 95}} },
    { "ffd787", {222, { 255, 215, 135}} },
    { "ffd7af", {223, { 255, 215, 175}} },
    { "ffd7d7", {224, { 255, 215, 215}} },
    { "ffd7ff", {225, { 255, 215, 255}} },
    { "ffff00", {226, { 255, 255, 0}} },
    { "ffff5f", {227, { 255, 255, 95}} },
    { "ffff87", {228, { 255, 255, 135}} },
    { "ffffaf", {229, { 255, 255, 175}} },
    { "ffffd7", {230, { 255, 255, 215}} },
    { "ffffff", {231, { 255, 255, 255}} },
    { "080808", {232, { 8, 8, 8}} },
    { "121212", {233, { 18, 18, 18}} },
    { "1c1c1c", {234, { 28, 28, 28}} },
    { "262626", {235, { 38, 38, 38}} },
    { "303030", {236, { 48, 48, 48}} },
    { "3a3a3a", {237, { 58, 58, 58}} },
    { "444444", {238, { 68, 68, 68}} },
    { "4e4e4e", {239, { 78, 78, 78}} },
    { "585858", {240, { 88, 88, 88}} },
    { "626262", {241, { 98, 98, 98}} },
    { "6c6c6c", {242, { 108, 108, 108}} },
    { "767676", {243, { 118, 118, 118}} },
    { "808080", {244, { 128, 128, 128}} },
    { "8a8a8a", {245, { 138, 138, 138}} },
    { "949494", {246, { 148, 148, 148}} },
    { "9e9e9e", {247, { 158, 158, 158}} },
    { "a8a8a8", {248, { 168, 168, 168}} },
    { "b2b2b2", {249, { 178, 178, 178}} },
    { "bcbcbc", {250, { 188, 188, 188}} },
    { "c6c6c6", {251, { 198, 198, 198}} },
    { "d0d0d0", {252, { 208, 208, 208}} },
    { "dadada", {253, { 218, 218, 218}} },
    { "e4e4e4", {254, { 228, 228, 228}} },
    { "eeeeee", {255, { 238, 238, 238}} }
  };
